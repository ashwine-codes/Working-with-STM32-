#include <stdio.h>
#include <stdint.h>

// Provided EDID 
uint8_t edid[256] =
{
    0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0a,0x13,0x45,0x32,0x00,0x00,0x00,0x00,
    0x00,0x18,0x01,0x03,0x80,0x00,0x00,0x78,0x1e,0xee,0x91,0xa3,0x54,0x4c,0x99,0x26,
    0x0f,0x50,0x54,0xff,0xff,0x80,0xd1,0xc0,0xa9,0x40,0xb3,0x00,0x90,0x40,0x81,0x40,
    0x81,0x80,0x81,0x00,0x61,0x40,0x02,0x3a,0x80,0x18,0x71,0x38,0x2d,0x40,0x58,0x58,
    0x45,0x00,0x00,0x00,0x00,0x00,0x00,0x1e,0x02,0x3a,0x80,0xd0,0x72,0x38,0x2d,0x40,
    0x10,0x2c,0x45,0x80,0x00,0x00,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0xfc,0x00,0x45,
    0x32,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xfd,
    0x00,0x17,0x78,0x0f,0xa0,0x3c,0x00,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x01,0xaf,
    0x02,0x03,0x35,0xf2,0x23,0x0d,0x16,0x07,0x6d,0x03,0x0c,0x00,0x10,0x00,0xb8,0x42,
    0x20,0x00,0x60,0x03,0x02,0x01,0x67,0xd8,0x5d,0xc4,0x01,0x77,0x80,0x00,0x51,0x90,
    0x05,0x04,0x13,0x14,0x9f,0x20,0x5d,0x5e,0x5f,0x60,0x61,0x62,0x63,0x64,0x65,0x66,
    0xe4,0x0f,0x00,0xfc,0x0f,0x02,0x3a,0x80,0x18,0x71,0x38,0x2d,0x40,0x58,0x2c,0x45,
    0x00,0x00,0x00,0x00,0x00,0x00,0x1e,0x01,0x1d,0x00,0x72,0x51,0xd0,0x1e,0x20,0x6e,
    0x28,0x55,0x00,0x00,0x00,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x24
};

// GETTER FUNCTIONS
uint8_t get_video_interface(uint8_t *edid) {
    return edid[20]; // Byte 20 = Video Input Definition
}

uint8_t get_audio_format_code(uint8_t *edid) {
    return (edid[133] & 0x78) >> 3; // Bits [6:3]
}

uint8_t get_audio_channels(uint8_t *edid) {
    return (edid[133] & 0x07) + 1;  // Bits [2:0] + 1
}

uint8_t get_audio_sample_freq(uint8_t *edid) {
    return edid[134]; // Bitmask for frequencies
}

uint8_t get_audio_bit_depth(uint8_t *edid) {
    return edid[135]; // Bitmask for bit depth
}

// SETTER FUNCTIONS
void set_video_interface_dp(uint8_t *edid) {
    edid[20] = 0xA0; // Eg: DisplayPort (bit7=1 + interface bits)
}

void set_audio_channels(uint8_t *edid, uint8_t channels) {
    edid[133] &= ~0x07;          // clear bits 2:0
    edid[133] |= (channels - 1); // encode channels-1
}

void set_audio_sample_freq_48k(uint8_t *edid) {
    edid[134] = 0x04; // only 48 kHz supported (bit2)
}

void set_audio_bit_depth_24(uint8_t *edid) {
    edid[135] = 0x04; // only 24-bit (bit2)
}

// MAIN DEMO
int main(void) {
    printf("Before modifications:\n");
    printf("Video Interface: 0x%02X\n", get_video_interface(edid));
    printf("Audio Format Code: %d\n", get_audio_format_code(edid));
    printf("Channels: %d\n", get_audio_channels(edid));
    printf("Sample Frequencies Mask: 0x%02X\n", get_audio_sample_freq(edid));
    printf("Bit Depth Mask: 0x%02X\n", get_audio_bit_depth(edid));

    // Modifying EDID
    set_video_interface_dp(edid);
    set_audio_channels(edid, 2);
    set_audio_sample_freq_48k(edid);
    set_audio_bit_depth_24(edid);

    printf("\nAfter modifications:\n");
    printf("Video Interface: 0x%02X\n", get_video_interface(edid));
    printf("Channels: %d\n", get_audio_channels(edid));
    printf("Sample Frequencies Mask: 0x%02X\n", get_audio_sample_freq(edid));
    printf("Bit Depth Mask: 0x%02X\n", get_audio_bit_depth(edid));

    return 0;
}
